diff -Npur ffmpeg-5.1.4/libavutil/hwcontext.c ffmpeg-5.1.4-change/libavutil/hwcontext.c
--- ffmpeg-5.1.4/libavutil/hwcontext.c	2023-11-10 07:38:51.000000000 +0800
+++ ffmpeg-5.1.4-change/libavutil/hwcontext.c	2024-12-09 15:02:58.586344895 +0800
@@ -363,7 +363,7 @@ int av_hwframe_ctx_init(AVBufferRef *ref
     if (ctx->internal->hw_type->frames_init) {
         ret = ctx->internal->hw_type->frames_init(ctx);
         if (ret < 0)
-            goto fail;
+            return ret;
     }
 
     if (ctx->internal->pool_internal && !ctx->pool)
@@ -373,14 +373,10 @@ int av_hwframe_ctx_init(AVBufferRef *ref
     if (ctx->initial_pool_size > 0) {
         ret = hwframe_pool_prealloc(ref);
         if (ret < 0)
-            goto fail;
+            return ret;
     }
 
     return 0;
-fail:
-    if (ctx->internal->hw_type->frames_uninit)
-        ctx->internal->hw_type->frames_uninit(ctx);
-    return ret;
 }
 
 int av_hwframe_transfer_get_formats(AVBufferRef *hwframe_ref,
